<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Letras Rápidas</title>
<style>
:root {
  font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  --accent: #1d4ed8;
}
body {
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#f3f4f6;
}
.card {
  width:96vw;
  max-width:480px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 6px 24px rgba(2,6,23,0.08);
  padding:0;
  display:flex;
  flex-direction:column;
  min-height:80vh;
}
.half-screen {
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  padding:8px;
  position:relative;
}
.half-screen.upper { transform: rotate(180deg); background:#e5e7eb; }
.half-screen.lower { background:#fef3c7; }
#letters1, #letters2 { font-size:56px; font-weight:700; letter-spacing:18px; text-align:center; margin:12px 0; }
button {
  background: var(--accent);
  color:#fff;
  border:0;
  padding:16px 20px;
  border-radius:10px;
  font-weight:600;
  font-size:18px;
  cursor:pointer;
}
.middle-buttons {
  display:flex;
  justify-content:space-around;
  margin:4px 0;
}
.muted { color:#6b7280; font-size:14px; text-align:center; padding:4px; }
#transcript, #verdict, #timer { font-weight:600; text-align:center; margin:8px 0; font-size:18px; }
#scoreboard { text-align:center; padding:12px; }
</style>
</head>
<body>
<div class="card">

  <div id="start-screen">
    <p class="muted">Clique em INICIAR. Após a contagem, duas letras serão exibidas. Quem souber uma palavra com as duas letras aperta RESPONDER e fala a palavra.</p>
    <div style="height:12px"></div>
    <button id="startBtn">INICIAR</button>
  </div>

  <div id="countdown" style="display:none;font-size:36px;margin-top:12px;text-align:center"></div>

  <div id="game" style="display:none;flex:1;flex-direction:column;">
    <div class="half-screen upper">
      <div id="letters2"></div>
      <button id="resp2">RESPONDER — Jogador 2</button>
    </div>

    <div class="middle-buttons">
      <button id="nextBtn" style="background:#f59e0b">PRÓXIMA</button>
      <button id="finishBtn" style="background:#d94664">FINALIZAR</button>
    </div>

    <div class="half-screen lower">
      <div id="letters1"></div>
      <button id="resp1">RESPONDER — Jogador 1</button>
    </div>

    <div id="timer"></div>
    <div id="transcript"></div>
    <div id="verdict"></div>
  </div>

  <div id="scoreboard" style="display:none;">
    <h2>Placar Final</h2>
    <p>Jogador 1: <span id="score1">0</span></p>
    <p>Jogador 2: <span id="score2">0</span></p>
    <p id="winner" style="font-size:20px;font-weight:700;margin-top:12px"></p>
    <button id="restartBtn">REINICIAR</button>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function pickTwoLetters(){ const letters="ABCDEFGHILMNOPQRSTUVXZ"; let a=letters[Math.floor(Math.random()*letters.length)]; let b=letters[Math.floor(Math.random()*letters.length)]; while(b===a) b=letters[Math.floor(Math.random()*letters.length)]; return [a,b]; }
function removeDiacritics(str){ return str.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/ß/g,'ss'); }

let currentLetters=[],answering=false,score1=0,score2=0;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
function isSpeechSupported(){ return !!SpeechRecognition; }

const startBtn=$('startBtn'), countdownEl=$('countdown'), gameEl=$('game'), startScreen=$('start-screen');
const letters1=$('letters1'), letters2=$('letters2');
const resp1=$('resp1'), resp2=$('resp2');
const transcriptEl=$('transcript'), verdictEl=$('verdict'), timerEl=$('timer');
const nextBtn=$('nextBtn'), finishBtn=$('finishBtn');
const scoreboardEl=$('scoreboard'), score1El=$('score1'), score2El=$('score2'), winnerEl=$('winner'), restartBtn=$('restartBtn');

startBtn.addEventListener('click', async()=>{
  startScreen.style.display='none';
  await runCountdownAndShowLetters();
});

async function runCountdownAndShowLetters(){
  countdownEl.style.display='';
  gameEl.style.display='none';
  for(let i=3;i>0;i--){ countdownEl.textContent=i; await sleep(700);}
  countdownEl.textContent='JÁ!'; await sleep(500);
  countdownEl.style.display='none';
  gameEl.style.display='flex';
  startRound();
}

function startRound(){
  currentLetters=pickTwoLetters();
  letters1.textContent=`${currentLetters[0]}   ${currentLetters[1]}`;
  letters2.textContent=`${currentLetters[0]}   ${currentLetters[1]}`;
  transcriptEl.textContent=''; verdictEl.textContent=''; timerEl.textContent='';
  answering=false; resp1.disabled=false; resp2.disabled=false;
}

nextBtn.addEventListener('click', startRound);
finishBtn.addEventListener('click', ()=>{
  gameEl.style.display='none'; scoreboardEl.style.display='';
  score1El.textContent=score1; score2El.textContent=score2;
  if(score1>score2) winnerEl.textContent='JOGADOR 1 VENCEU';
  else if(score2>score1) winnerEl.textContent='JOGADOR 2 VENCEU';
  else winnerEl.textContent='EMPATE!';
});
restartBtn.addEventListener('click', ()=>{
  score1=0; score2=0;
  scoreboardEl.style.display='none'; startScreen.style.display='';
});

resp1.addEventListener('click', ()=>onResponderPress(1));
resp2.addEventListener('click', ()=>onResponderPress(2));

async function onResponderPress(player){
  if(answering){ transcriptEl.textContent=`Já tem jogador respondendo (Jogador ${answering}).`; return;}
  answering=player; resp1.disabled=true; resp2.disabled=true;

  let timeLeft=3;
  timerEl.textContent=`Tempo restante: ${timeLeft}s`;
  const timerInterval=setInterval(()=>{
    timeLeft--;
    timerEl.textContent=`Tempo restante: ${timeLeft}s`;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      timerEl.textContent='Tempo esgotado!';
      verdictEl.textContent='Rodada inválida!';
      startRound();
    }
  },1000);

  transcriptEl.textContent=`Jogador ${player}: fale agora!`;

  if(!isSpeechSupported()){ verdictEl.textContent='Reconhecimento de voz não suportado'; clearInterval(timerInterval); return; }

  try{
    await startRecognitionForPlayer(player, clearInterval(timerInterval));
  }catch(e){ transcriptEl.textContent='Erro: '+e; answering=false; resp1.disabled=false; resp2.disabled=false; clearInterval(timerInterval);}
}

function startRecognitionForPlayer(player, clearTimer){
  return new Promise((resolve,reject)=>{
    const rec=new SpeechRecognition();
    rec.lang='pt-BR'; rec.interimResults=false; rec.maxAlternatives=1;

    rec.onresult=async(ev)=>{
      clearTimer();
      const transcript=ev.results[0][0].transcript.trim();
      transcriptEl.textContent=`Jogador ${player} disse: "${transcript}"`;
      await processAnswer(player, transcript);
      resolve();
    };
    rec.onerror=(e)=>{ clearTimer(); transcriptEl.textContent='Erro no reconhecimento: '+(e.error||e.message); answering=false; resp1.disabled=false; resp2.disabled=false; reject(e);}
    try{ rec.start(); }catch(e){ reject(e);}
  });
}

async function processAnswer(player, spoken){
  const rawWord = spoken.split(/\s+/)[0];
  if(!rawWord){ verdictEl.textContent='Não entendi uma palavra'; answering=false; resp1.disabled=false; resp2.disabled=false; return; }
  const normalized = removeDiacritics(rawWord.toLowerCase());
  const l1=currentLetters[0].toLowerCase(), l2=currentLetters[1].toLowerCase();
  const contains=normalized.includes(l1)&&normalized.includes(l2);

  if(!contains){ verdictEl.innerHTML=`<span style="color:#d94664">ERRO — "${rawWord}" não contém ${currentLetters.join(', ')}</span>`;}
  else{ verdictEl.innerHTML=`<span style="color:#059669">ACERTO — "${rawWord}" contém ${currentLetters.join(', ')}</span>`;
       if(player===1) score1++; else score2++; }
  
  setTimeout(startRound,1500);
}

if(!isSpeechSupported()){ startScreen.querySelector('.muted').textContent+=' (Seu navegador pode não suportar reconhecimento de voz.)';}
</script>
</body>
</html>
